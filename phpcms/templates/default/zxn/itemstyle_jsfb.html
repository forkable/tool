<form id="tForm" form-data="defaultStyle" method="post" >
<div id="tabs-1">
	<ul class="setform">
		<li>
			<label for="itemStyle">排版：</label>
			<select id="itemStyle" name="itemStyle">
							<option value="31">预设样式1 - 竖向一行两列</option>
							<option value="32">预设样式2</option>
							<option value="33">预设样式3</option>
							<option value="163">预设样式4</option>
						</select>
		</li>
		<div id="ispCodeBox">

			<textarea id="31_code" style="display:none;">{"appID":"aAGUG-tkci","formatName":"sb2","appLabel":"店铺分类1","shopHref":"http://mianxiansheng.tmall.com/","catsArray":["1287003561","1330768777","1328543616","1328012501","1328031691","1326114477","1325082205","1294210462","1312595481","1312595482","1312595483","1312595484","1312595485","1312595486","1303900320","1294210463","1312591523","1312591524","1312591525","220452779","1305033416","1294210482","1294210483","1294210484","1294210485","1294210486","1294210469","1294210470","1294210471","1294210472","1294231440","1312581566","1312581567","1312581563","1312581564","1312581565","1294210465","1294210466","1294210467","1294210468","1294231439"],"catsWidth":"190","catsHeight":"50","characterBgSrc":"","characterAlign":"center","catsSpace":"","hrefMode":"_blank","characterSize":"16","characterWeight":"normal","characterFont":"微软雅黑","characterColor":"#000000","characterBgColor":"#E0E0E0","characterDash":"off","characterHoverMode":"on","characterHoverSpeed":"trans05s","characterBgSrcHover":"","characterSizeHover":"16","characterWeightHover":"normal","characterFontHover":"微软雅黑","characterColorHover":"#FFFFFF","characterBgColorHover":"#1264BA","characterUnderLine":"on","characterUnderLineStyle":"solid","characterUnderLineWeight":"3","characterUnderLineColor":"#FF0000","subCatsWidth":"95","subCatsHeight":"36","characterBgSrc1":"","characterAlign1":"center","catsSpace1":"","hrefMode1":"_blank","characterSize1":"13","characterWeight1":"normal","characterFont1":"微软雅黑","characterColor1":"#575455","characterBgColor1":"#FFFFFF","characterDash1":"off","characterHoverMode1":"on","characterHoverSpeed1":"","characterBgSrcHover1":"","characterSizeHover1":"13","characterWeightHover1":"normal","characterFontHover1":"微软雅黑","characterColorHover1":"#1264BA","characterBgColorHover1":"","characterUnderLine1":"on","characterUnderLineStyle1":"solid","characterUnderLineWeight1":"1","characterUnderLineColor1":"#1264BA","childConfig":[]}</textarea>
			<textarea id="31_code1" style="display:none;">{}</textarea>
					
			<textarea id="32_code" style="display:none;">{"appID":"app17969433-2811","formatName":"sb1","catsArray":["861100029","391602852","1029393718","1027471994","1022811164","1017236187","1013097777","1006097168","873396072","721716828","721716829","721716830","724448980","972797899","935936532","870309116","995030863","723845139","919748937","774420684","774420690","919748938","893100151","893118657","774420692","774420689","778486502","783700973","783700975","783700972","783700977","774427164","783700976","868309665","721716834","721716837","721716838","722326747","893132376","949167758","949167759","949167760","659533695","687850341","708754884","789614204","708758311","708800758","951029157","951368695","951368696","1016779223","1016779224","1016779225","1016779226","1016779227","1016779228","1022015609","961911079","988934530","988934531","989196814","989196815","989202996","989202997","989202998","989202999","989203000","995741230","997734269","1014686062","1001871133","1001890367","1009903345","1009903346","1009903347","1021955223","861100029","391602852","1029393718","1027471994","1022811164","1017236187","1013097777","1006097168","873396072","721716828","721716829","721716830","724448980","972797899","935936532","870309116","995030863","723845139","919748937","774420684","774420690","919748938","893100151","893118657","774420692","774420689","778486502","783700973","783700975","783700972","783700977","774427164","783700976","868309665","721716834","721716837","721716838","722326747","893132376","949167758","949167759","949167760","659533695","687850341","708754884","789614204","708758311","708800758","951029157","951368695","951368696","1016779223","1016779224","1016779225","1016779226","1016779227","1016779228","1022015609","961911079","988934530","988934531","989196814","989196815","989202996","989202997","989202998","989202999","989203000","995741230","997734269","1014686062","1001871133","1001890367","1009903345","1009903346","1009903347","1021955223"],"catsWidth":"190","catsHeight":"40","characterBgSrc":"http://img04.taobaocdn.com/imgextra/i4/39767794/TB2_mhJbFXXXXbVXpXXXXXXXXXX-39767794.png","characterAlign":"left","catsSpace":"20","hrefMode":"_blank","characterSize":"14","characterWeight":"normal","characterFont":"微软雅黑","characterColor":"#000000","characterBgColor":"#FFFFFF","characterDash":"off","characterHoverMode":"on","characterHoverSpeed":"trans05s","characterBgSrcHover":"http://img04.taobaocdn.com/imgextra/i4/39767794/TB2hA8UbFXXXXa0XXXXXXXXXXXX-39767794.png","characterSizeHover":"14","characterWeightHover":"normal","characterFontHover":"微软雅黑","characterColorHover":"#ffffff","characterBgColorHover":"","characterUnderLine":"off","characterUnderLineStyle":"solid","characterUnderLineWeight":"1","characterUnderLineColor":"#000000","subCatsWidth":"190","subCatsHeight":"30","characterBgSrc1":"","characterAlign1":"left","catsSpace1":"40","hrefMode1":"_blank","characterSize1":"12","characterWeight1":"normal","characterFont1":"微软雅黑","characterColor1":"#333333","characterBgColor1":"#FFFFFF","characterDash1":"off","characterHoverMode1":"on","characterHoverSpeed1":"","characterBgSrcHover1":"","characterSizeHover1":"12","characterWeightHover1":"normal","characterFontHover1":"微软雅黑","characterColorHover1":"#ffffff","characterBgColorHover1":"#333333","characterUnderLine1":"off","characterUnderLineStyle1":"solid","characterUnderLineWeight1":"1","characterUnderLineColor1":"#000000","childConfig":[]}</textarea>
			<textarea id="32_code1" style="display:none;">{}</textarea>
					
			<textarea id="33_code" style="display:none;">{"appID":"app27471124-1707","formatName":"sb4","catsArray":["914461438","1023944192","1023944193","888660936","1023651032","1023651033","1023646087","1023646088","1023646089","888660937","127115004","127115006","144552201","127115005","975294236","975289430","975289431","975289455","127115007","127115008","173726727","127115009","975289434","975289435","975289437","982299428","975289439","975289440","385611837","128978102","128978103","128978104","128978106","128978108","128978111","914525042","1023982380","1023982381","1023982382","914525044","914525045","914525046","914525047","455451334","531337697","531337698","914525048","914525049","914525050","914525051","914525052","914525053","1023982383"],"catsWidth":"115","catsHeight":"44","characterBgSrc":"http://img01.taobaocdn.com/imgextra/i1/39767794/TB2m2BMbFXXXXbqXpXXXXXXXXXX-39767794.png","characterAlign":"center","catsSpace":"","hrefMode":"_blank","characterSize":"14","characterWeight":"bold","characterFont":"微软雅黑","characterColor":"#993A3A","characterBgColor":"","characterDash":"off","characterHoverMode":"on","characterHoverSpeed":"","characterBgSrcHover":"http://img01.taobaocdn.com/imgextra/i1/39767794/TB2m2BMbFXXXXbqXpXXXXXXXXXX-39767794.png","characterSizeHover":"14","characterWeightHover":"bold","characterFontHover":"微软雅黑","characterColorHover":"#591414","characterBgColorHover":"","characterUnderLine":"off","characterUnderLineStyle":"dotted","characterUnderLineWeight":"1","characterUnderLineColor":"#993A3A","subCatsWidth":"115","subCatsHeight":"30","characterBgSrc1":"http://img01.taobaocdn.com/imgextra/i1/39767794/TB2m2BMbFXXXXbqXpXXXXXXXXXX-39767794.png","characterAlign1":"center","catsSpace1":"","hrefMode1":"_blank","characterSize1":"12","characterWeight1":"normal","characterFont1":"微软雅黑","characterColor1":"#993A3A","characterBgColor1":"","characterDash1":"off","characterHoverMode1":"on","characterHoverSpeed1":"","characterBgSrcHover1":"","characterSizeHover1":"12","characterWeightHover1":"normal","characterFontHover1":"微软雅黑","characterColorHover1":"#000000","characterBgColorHover1":"","characterUnderLine1":"off","characterUnderLineStyle1":"dotted","characterUnderLineWeight1":"1","characterUnderLineColor1":"#993A3A","childConfig":[]}</textarea>
			<textarea id="33_code1" style="display:none;">{}</textarea>
					
			<textarea id="163_code" style="display:none;">{"appID":"ad9WT-JvKc","shopHref":"http://kangnaiguanfang.tmall.com/","hrefMode":"_blank","characterBgSrc":"","characterBgSrcHover":"","characterAlign":"left","characterSize":"14","characterWeight":"bold","characterFont":"微软雅黑","characterColor":"#000000","characterBgColor":"","characterDash":"off","characterHoverMode":"off","characterHoverSpeed":"","characterSizeHover":"12","characterWeightHover":"normal","characterFontHover":"宋体","characterColorHover":"#000000","characterBgColorHover":"","characterUnderLine":"off","characterUnderLineStyle":"solid","characterUnderLineWeight":"1","characterUnderLineColor":"#000000","formatName":"hb1","catsWidth":"150","catsHeight":"40","catsSpace":20,"subCatsWidth":"150","subCatsHeight":"40","catsSpace1":40,"hrefMode1":"_blank","characterBgSrc1":"","characterBgSrcHover1":"","characterAlign1":"left","characterSize1":"12","characterWeight1":"normal","characterFont1":"微软雅黑","characterColor1":"#333333","characterBgColor1":"","characterDash1":"off","characterHoverMode1":"off","characterHoverSpeed1":"","characterSizeHover1":"12","characterWeightHover1":"normal","characterFontHover1":"宋体","characterColorHover1":"#000000","characterBgColorHover1":"","characterUnderLine1":"off","characterUnderLineStyle1":"solid","characterUnderLineWeight1":"1","characterUnderLineColor1":"#000000","catsArray":["888660936","1023651032","1023651033","914461438","1023944192","1023944193","1114922146","127115004","127115005","144552201","127115006","1114922147","1114922832","1114922833","1114922131","1114922132","1114922133","1114922134","1114922127","1114922128","1114922129","1114922130","127115008","173726727","127115009","1114922150","1114922139","1114922140","1114922141","1114922142","1114922135","1114922136","1114922137","1114922138","1107992994","1107992995","1107992996","1107992997","1107992998","1114922151","1115019271"],"childConfig":[],"appLabel":"店铺分类1"}</textarea>
			<textarea id="163_code1" style="display:none;">{}</textarea>
		</div>
		<ul id="carouselForItemStyle" class="elastislide-list">
			<li data-selectedID="31" data-preview="https://img.alicdn.com/imgextra/i1/800803731/TB2rhjvb1UkyKJjSspjXXbKTXXa-800803731.jpg" data-username="" data-text="预设样式1" style="overflow:visible;">
				<a class="june-preview" href="javascript:void(0);" style="">
					<img src="https://img.alicdn.com/imgextra/i1/800803731/TB2rhjvb1UkyKJjSspjXXbKTXXa-800803731.jpg" title="预设样式1" />
				</a>
			</li>
			<li data-selectedID="32" data-preview="http://img03.taobaocdn.com/imgextra/i3/39767794/TB27rBMbFXXXXaKXpXXXXXXXXXX-39767794.png" data-username="" data-text="预设样式2" style="overflow:visible;">
				<a class="june-preview" href="javascript:void(0);" style="">
					<img src="http://img03.taobaocdn.com/imgextra/i3/39767794/TB27rBMbFXXXXaKXpXXXXXXXXXX-39767794.png" title="预设样式2" />
				</a>
			</li>
			<li data-selectedID="33" data-preview="http://img03.taobaocdn.com/imgextra/i3/39767794/TB2zbBWbFXXXXa0XXXXXXXXXXXX-39767794.jpg" data-username="" data-text="预设样式3" style="overflow:visible;">
				<a class="june-preview" href="javascript:void(0);" style="">
					<img src="http://img03.taobaocdn.com/imgextra/i3/39767794/TB2zbBWbFXXXXa0XXXXXXXXXXXX-39767794.jpg" title="预设样式3" />
				</a>
			</li>
			<li data-selectedID="163" data-preview="https://img.alicdn.com/imgextra/i4/39767794/TB2e85dfpXXXXcJXXXXXXXXXXXX-39767794.jpg" data-username="" data-text="预设样式4" style="overflow:visible;">
				<a class="june-preview" href="javascript:void(0);" style="">
					<img src="https://img.alicdn.com/imgextra/i4/39767794/TB2e85dfpXXXXcJXXXXXXXXXXXX-39767794.jpg" title="预设样式4" />
				</a>
			</li>
		</ul>
		<div class="image-preview">
			<iframe id="previewForItemStyleFrame" src="itemStylePreview.php?ID=31" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" scrolling="no" style="display:none;display:none;height:320px;width:480px;float:none;margin: 0 auto;"></iframe>
			<img id="previewForItemStyle" style="max-height:320px;max-width:480px;float:none;" src="https://img.alicdn.com/imgextra/i1/800803731/TB2rhjvb1UkyKJjSspjXXbKTXXa-800803731.jpg"/>
		</div>
			</ul>
</div>
</form>
<div id="styledialogedit" style="display:none;">
	<ul class="setform">
		<input type="hidden" id="styleID" class="setinput" name="styleID" value="" />
		<li>
			<label for="setitemstylename" data-afe="44">预设样式缩略图：</label>
			<input type="text" id="styleUrl" class="setinput" name="styleUrl" value="" />
		</li>
		<li>
			<label for="setitemstyletext">预设样式名称：</label>
			<input type="text" id="styleText" class="setinput" name="styleText" value="" />
		</li>
	</ul>
</div>
<script type="text/javascript">
$(function() {
//加载表单样式
	//$("#tForm select").selectmenu();
	var styleType = "jsfb";
	$("#styledialogedit").dialog({
		autoOpen: false,
		resizable: true,
		modal: true,
		width: 520,
		title: "修改预设样式",
		buttons:{
			"确定": function(event) {
				var styleID = $("#styleID").val(),
					styleUrl = $("#styleUrl").val(),
					styleText = $("#styleText").val();
				if(styleText == "" || !checkUrl(styleUrl)) {
					D.tMessage("请输入正确的预设样式名和缩略图！");
					return;
				}
				$.ajax({
					url: "styleexamine.php",
					type: "POST",
					data: {
						ID: styleID,
						styleurl: styleUrl,
						styletext: styleText,
						type: "edit1"
					},
					dataType: "json",
					success: function(m) {
						if(m[0]) {
							$("#itemStyle").children("option[value='"+styleID+"']").text(styleText);
							$("#itemStyle").selectmenu("refresh");
							$carouselEl.children("li[data-selectedID='"+styleID+"']").attr("data-text", styleText).attr("data-preview", styleUrl);
							$carouselEl.children("li[data-selectedID='"+styleID+"']").children("a").children("img").attr("src", styleUrl).attr("title", styleText);
							$preview.attr("src", styleUrl);
							D.tMessage("修改成功！");
						} else {
							if(m[1]) {
								D.tMessage(m[1]);
							} else {
								D.tMessage("修改失败！请稍后重试！");
							}
						}
					}
				});
				$(this).dialog( "close" );$(".ui-tooltip").hide();
			},
			"取消": function() {
				$(this).dialog( "close" );$(".ui-tooltip").hide();
			}
		}
	});
	
	var current = 0,
	$preview = $( '#previewForItemStyle' ),
	$previewAuthor = $( '#previewForItemStyleAuthor' ),
	$previewBox = $( '#previewForItemStyleExamBox' ),
	$carouselEl = $( '#carouselForItemStyle' ),
	
	$carouselItems = $carouselEl.children(),
	carousel = $carouselEl.elastislide( {
		current : current,
		minItems : 4,
		onReady : function() {
			changeImage( $carouselItems.eq( current ), current );
		}
	} );
	var D = require("scripts/D");
	
	$carouselEl.off("click").on("click.elasti", "li", function() {
		var index = $(this).index();
		changeImage( $(this), index );
	}).on("click.deletestyle", "span.style-delete-btn", function() {
		var _li = $(this).parent(), ID = _li.attr("data-selectedID");
		D.tConfirm("您正在进行删除预设样式的操作，是否确认删除该预设样式？", function() {
			$.ajax({
				url: "styleexamine.php",
				type: "POST",
				data: {
					ID: ID,
					type: "delete"
				},
				dataType: "json",
				success: function(m) {
					if(m[0]) {
						$("#itemStyle").children("option[value='"+ID+"']").remove();
						$("#itemStyle").selectmenu("refresh");
						$carouselEl.children("li[data-selectedID='"+ID+"']").remove();
						$preview.attr("src", "");
						$("#carouselForItemStyle").children("li:eq(0)").trigger("click");
					}
				}
			});

		});
	}).on("click.editstyle", "span.style-edit-btn", function() {
		var _li = $(this).parent(), url = _li.attr("data-preview"), text = _li.attr("data-text"), ID = _li.attr("data-selectedID") || "";
		if(ID != "") {
			$("#styleUrl").val(url);
			$("#styleText").val(text);
			$("#styleID").val(ID);
			$("#styledialogedit").dialog("open");
		} else {
			D.tMessage("该预设样式处于异常状态，可能已经不存在！请刷新重试或联系管理员！");
		}
	});
	
	$("#previewForItemStyleFrame").off("load").on("load", function(event) {
		var ifm= document.getElementById("previewForItemStyleFrame");
		var subWeb = document.frames ? document.frames["previewForItemStyleFrame"].document : ifm.contentDocument;   
		var _subBody = $(subWeb.body), tempWidth;
		var w = 480 / subWeb.body.scrollWidth, h = 320 / subWeb.body.scrollHeight, ifmHeight;
		w > h ?
		(_subBody.css({transformOrigin: "top left", transform: "scale("+h+", "+h+")"}), ifmHeight = _subBody.height() * h, tempWidth = _subBody.children().width() * h):
		(_subBody.css({transformOrigin: "top left", transform: "scale("+w+", "+w+")"}), ifmHeight = _subBody.height() * w, tempWidth = _subBody.children().width() * w);
		//(subWeb.body.style.zoom = h, ifmHeight = $(subWeb.body).height() * h):
		//(subWeb.body.style.zoom = w, ifmHeight = $(subWeb.body).height() * w);
		$(ifm).css({
			"height": ifmHeight,
			"margin-top": m(($("#tForm").height() - 125 - ifmHeight) / 2)
		});
		_subBody.css("margin-left", (480 - tempWidth) / 2);
	});
	
	function changeImage( el, pos ) {
		var oldID = $("#itemStyle").attr("data-selectedID") || "";
		$("#itemStyle").children(":eq("+pos+")").prop("selected", true);
		$( "#itemStyle" ).selectmenu( "refresh" );
		$("#itemStyle").attr("data-selectedID", el.attr( 'data-selectedID' ));
		if(oldID == el.attr( 'data-selectedID' )) {return;}
		if(styleType == "") {//jfsb
			$("#previewForItemStyleFrame").attr( 'src', "itemStylePreview.php?ID="+el.attr( 'data-selectedID' ) );
		} else {
			$preview.attr( 'src', el.data( 'preview' ) );
		}
		if($previewAuthor.length > 0) {
			$previewAuthor.html("作者："+ el.attr( 'data-username' ))
		}
		if($previewBox.length > 0) {
			$previewBox.attr('data-styleID', el.attr( 'data-selectedID' ));
		}
		$carouselItems.removeClass( 'current-img' );
		el.addClass( 'current-img' );
		carousel.setCurrent( pos );
	}
	$("#itemStyle").selectmenu({
		change: function( event, ui ) {
			var v = $(this).val();
			$("#carouselForItemStyle").children("li[data-selectedID='"+v+"']").trigger("click");
		}
	});
	$("#previewForItemStyleExam").on("click", function(event) {
		var _t = $(this), ID = _t.parent().attr("data-styleID");
		$.ajax({
			url: "styleexamine.php",
			type: "POST",
			data: {
				ID: ID,
				type: "examine"
			},
			dataType: "json",
			success: function(m) {
				if(m[0]) {
					$("#itemStyle").children("option[value='"+ID+"']").remove();
					$("#itemStyle").selectmenu("refresh");
					$carouselEl.children("li[data-selectedID='"+ID+"']").remove();
					$preview.attr("src", "");
					$("#carouselForItemStyle").children("li:eq(0)").trigger("click");
				}
			}
		});
	});
	
	$("#previewForItemStyleNoExam").on("click", function(event) {
		var _t = $(this), ID = _t.parent().attr("data-styleID");
		$.ajax({
			url: "styleexamine.php",
			type: "POST",
			data: {
				ID: ID,
				type: "noexamine"
			},
			dataType: "json",
			success: function(m) {
				if(m[0]) {
					$("#itemStyle").children("option[value='"+ID+"']").remove();
					$("#itemStyle").selectmenu("refresh");
					$carouselEl.children("li[data-selectedID='"+ID+"']").remove();
					$preview.attr("src", "");
					$("#carouselForItemStyle").children("li:eq(0)").trigger("click");
				}
			}
		});
	});
	
	$("#previewForItemStyleEdit").on("click", function(event) {
		var _t = $(this), ID = _t.parent().attr("data-styleID"),
		src = $("#previewForItemStyleSrcInput").val();
		$.ajax({
			url: "styleexamine.php",
			type: "POST",
			data: {
				ID: ID,
				styleurl: src,
				type: "edit"
			},
			dataType: "json",
			success: function(m) {
				if(m[0]) {
					$carouselEl.children("li[data-selectedID='"+ID+"']").children("a").children("img").attr("src", src);
					$preview.attr("src", src);
				}
			}
		});
	});
});
</script>